<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <!-- pretendard -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <!-- onset -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Onest:wght@100..900&display=swap" rel="stylesheet" />

    <!-- Noto Serif Display ExtraCondensed -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Asta+Sans:wght@300..800&family=Noto+Serif+Display:ital,wght@0,100..900;1,100..900&family=Onest:wght@100..900&display=swap" rel="stylesheet" />

    <!--Asta Sans  -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Asta+Sans:wght@300..800&family=Onest:wght@100..900&display=swap" rel="stylesheet" />

    <!-- tailwindcss -->
    <script src="/js/tailwind.js"></script>

    <!-- swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- util js -->
    <script defer src="/js/disableRightClick.js"></script>
    <script defer src="/js/popup.js"></script>

    <!-- data -->
    <script src="/js/jsonLoader.js"></script>
  </head>
  <body class="bg-[#FAFAFA] leading-[130%] tracking-[-1px] text-sm relative" oncontextmenu="return false;" style="font-family: 'Asta Sans', sans-serif">
    <div class="absolute top-0 left-0 z-10">
      <div class="flex items-center justify-center w-screen h-screen box-border">
        <div class="z-10 absolute left-2 top-2 bottom-8 right-2 toContainerBox bg-[#FAFAFA] overflow-y-auto">
          <section>
            <div cnb_module="shk-detail-header" class="mt-10 ml-2 md:mt-14 md:ml-10 mb-[30px] md:mb-12 text-[#121212] text-2xl md:text-[40px] leading-[130%] h-[62px] md:min-h-[100px] font-bold"></div>
            <div class="flex justify-end md:justify-between items-center mb-3 md:mx-10">
              <div class="gap-3 text-[var(--main-color)] text-sm hidden md:flex items-center" cnb_module="shk-detail-description"></div>
              <a cnb_module="shk-detail-link" href="#" class="text-[#FF5E1D] text-sm flex items-center">
                <div>사이트 바로가기</div>
                <div class="text-[var(--main-color)]">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 8L16 8M16 8L16 14M16 8L8 16" stroke="currentColor" stroke-width="1.2" />
                  </svg>
                </div>
              </a>
            </div>
            <div cnb_module="shk-detail-mainBanner" class="h-[240px] md:h-[520px] md:mx-10"></div>
          </section>
          <section class="mx-6 md:mx-10 flex items-center justify-center mt-8 md:mt-[120px]">
            <div cnb_module="shk-detail-information" class="w-[618px] mx-auto"></div>
          </section>
          <section cnb_module="shk-detail-subBanner" class="mt-12 md:mt-[120px]"></section>
          <!-- <section class="flex flex-col justify-between relative mt-[120px] w-full h-full max-h-[1014px] border-box bg-[url('/src/youngranu/item-2.png')] bg-center bg-no-repeat bg-cover">
            <div class="w-full max-w-[446px] mx-auto mt-2"><img src="/src/youngranu/text_Effortless.svg" alt="" class="size-full object-cover" /></div>
            <div class="relative grow">
              <div class="absolute left-1/2 -top-10 -bottom-10 -translate-x-1/2 w-full max-w-[430px]"><img src="/src/youngranu/item-3.png" alt="" class="size-full object-cover" /></div>
            </div>
            <div class="w-full max-w-[508px] mx-auto pb-[174px]"><img src="/src/youngranu/text_Experience.svg" alt="" class="size-full object-cover" /></div>
          </section> -->
          <section id="pages" class="mt-12 md:mt-[128px] mb-[54px] md:mb-[120px]">
            <div class="swiper">
              <div class="swiper-wrapper">
                <div class="swiper-slide" cnb-module="shk-detail-slide"></div>
              </div>
              <div class="swiperPaginationParentBox">
                <div class="swiper-pagination"></div>
              </div>
            </div>
          </section>
          <section>
            <div cnb_module="shk-detail-grid" class="grid grid-cols-1 md:grid-cols-2 gap-0 md:gap-2"></div>
          </section>
        </div>
        <div id="linkBox" class="hidden md:flex fixed gap-2 flex-shrink-0 bottom-[72px] h-[72px] left-1/2 -translate-x-1/2 items-center rounded-[12px] z-[9999]">
          <button onclick="openModal();" id="categoryToggleBox" class="w-[72px] h-[72px] bg-[#DDDDDDE5] rounded-lg flex items-center justify-center cursor-pointer group"><img src="/src/svg/icon_category.svg" alt="" class="group-hover:opacity-70 transition-opacity duration-300" /></button>
          <div class="bg-[#DDDDDDE5] w-[800px] h-full flex items-center justify-between rounded-xl px-2">
            <button onclick="goPrev();" class="flex items-center gap-2 cursor-pointer hover:opacity-70 transition-all">
              <img src="/src/svg/icon_arrow-left.svg" alt="" />
              <div class="text-[#767676] text-sm">PREV</div>
            </button>
            <div id="projectName" class="text-[#121212] text-base"></div>
            <button onclick="goNext();" class="flex items-center gap-2 cursor-pointer hover:opacity-70 transition-all">
              <div class="text-[#767676] text-sm">NEXT</div>
              <img src="/src/svg/icon_arrow-right.svg" alt="" />
            </button>
          </div>
          <a href="/pages/list.html" class="bg-[#DDDDDDE5] rounded-xl w-[72px] h-full flex items-center justify-center group">
            <img src="/src/svg/icon_cancel.svg" alt="" class="group-hover:opacity-50 transition-opacity duration-300" />
          </a>
        </div>
        <div id="category" class="absolute top-2 bottom-8 left-2 right-2 z-50 bg-[#EEEEEE] font-['pretendard']">
          <div class="ml-6 mt-16 text-[32px] font-medium flex flex-col gap-12">
            <a href="/pages/list.html">포트폴리오</a>
            <div>회사소개</div>
            <div>슉 페이지 추가?</div>
            <a class="flex gap-2 h-10 items-center">
              <div>회사소개서</div>
              <div href="#" class="ml-2"><img src="/src/svg/icon_download2-black.svg" alt="" /></div>
            </a>
          </div>
          <div class="ml-6 mt-[17.8%] text-[#999] text-sm font-medium">
            서울, 강남구 대치동, 88-88,
            <br />
            3층 코드앤블록
            <br />
            codenblock@gmail.com
            <br />
            02.1111.1111
          </div>
        </div>
        <div id="footer" class="flex justify-between mx-4 absolute bottom-2 left-0 right-0">
          <a href="/index.html"><img src="/src/svg/text_codenblock.svg" alt="" /></a>
          <div class="items-center gap-2 hidden md:flex">
            <a href="mailto:codenblock@gmail.com">codenblock@gmail.com</a>
            <div class="w-1 h-1 bg-[#E1E2E4]"></div>
            <a href="#" class="flex gap-1.5 items-center">
              <div class="text-sm font-medium flex">회사소개서</div>
              <div class="w-[18px] h-[18px]"><img src="/src/svg/icon_download2-black.svg" alt="" class="size-full object-cover" /></div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="boxes fixed inset-0 flex items-center justify-center pointer-events-none z-[9999]">
      <div class="box bg-black absolute top-2 left-2 w-4 h-4"></div>
      <div class="box bg-black absolute top-2 right-2 w-4 h-4"></div>
      <div class="box bg-black absolute bottom-8 left-2 w-4 h-4"></div>
      <div class="box bg-black absolute bottom-8 right-2 w-4 h-4"></div>
    </div>
  </body>

  <style>
    .swiperPaginationParentBox {
      /* max-width: 150px; */
      position: relative;
      width: 100%;
      margin: 80px auto;
    }

    .swiper-pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;

      overflow: hidden;
    }

    .swiper-pagination-bullet {
      width: 2px;
      height: 12px;
      /* 기본 높이 */
      background: #c4c4c4;
      opacity: 1;
      border-radius: 0;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .swiper-pagination-bullet-active {
      height: 18px;
      /* active 높이 */
      background: #0b1623;
    }
  </style>

  <style>
    .toContainerBox {
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .toContainerBox::-webkit-scrollbar {
      display: none;
    }

    #category {
      display: none;
    }

    #category.active {
      display: block;
    }

    #portfolio::after {
      content: "21";
      border-radius: 100px;
      position: absolute;
      top: -2px;
      right: 0;
      color: white;
      font-size: 12px;
      font-family: "Asta Sans";
      background: #020f2333;
      padding: 2px 8px;
    }
  </style>

  <script>
    let currentId = 1;
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    function goPrev() {
      if (currentId > 1) {
        const newId = currentId - 1;
        currentId = newId;
        const project = portfolioData.find((item) => item.id === newId);
        if (project) {
          onPortfolioReady(project);
          window.history.pushState({}, "", `/pages/detail.html?id=${newId}`);
        }
      }
    }

    function goNext() {
      const totalProjects = portfolioData.length;
      if (currentId < totalProjects) {
        const newId = currentId + 1;
        currentId = newId;
        const project = portfolioData.find((item) => item.id === newId);
        if (project) {
          onPortfolioReady(project);
          window.history.pushState({}, "", `/pages/detail.html?id=${newId}`);
        }
      }
    }

    // 그리기 시작
    function onPortfolioReady(project) {
      const totalProjects = portfolioData.length;
      const params = new URLSearchParams(window.location.search);
      // mainColor
      document.documentElement.style.setProperty("--main-color", project.detail.mainColor);

      // header
      updateHeader(project.detail.header);

      // subtitle
      updateDescription(project.detail.description);

      // mainBanner
      updateMainBanner(project.detail.mainBanner);

      //subBanner
      updateSubBanner(project.detail.subBanner);

      // link
      updateLinks(project.detail.url);

      // information
      updateInformation(project.detail.information);

      // swiper
      updateSwiper(project.detail.swiper);

      //grid
      updateGrid(project.detail.grid);

      //버튼 효과
      updateButtonState(currentId, totalProjects, prevBtn, nextBtn);

      const projectNameEl = document.getElementById("projectName");
      if (projectNameEl) {
        projectNameEl.textContent = project.projectName;
      }
    }

    //버튼 효과

    function updateHeader(headerText) {
      const headerEl = document.querySelector('[cnb_module="shk-detail-header"]');
      if (headerEl) headerEl.innerHTML = headerText;
    }

    function updateDescription(descriptions) {
      const descBox = document.querySelector('[cnb_module="shk-detail-description"]');
      if (descBox && Array.isArray(descriptions)) {
        descBox.innerHTML = "";
        descriptions.forEach((item, index) => {
          const textEl = document.createElement("div");
          textEl.textContent = item;
          descBox.appendChild(textEl);
          if (index < descriptions.length - 1) {
            const dot = document.createElement("div");
            dot.className = "size-2 bg-[var(--main-color)] rounded-full";
            descBox.appendChild(dot);
          }
        });
      }
    }

    function updateMainBanner(mainBannerUrl) {
      const bannerBox = document.querySelector('[cnb_module="shk-detail-mainBanner"]');
      if (!bannerBox || !mainBannerUrl) return;

      let img = bannerBox.querySelector("img");
      if (!img) {
        img = document.createElement("img");
        img.alt = "메인 배너";
        img.className = "size-full object-cover";
        bannerBox.appendChild(img);
      }
      img.src = mainBannerUrl;
    }

    function updateSubBanner(subBannerUrl) {
      const subBannerBox = document.querySelector('[cnb_module="shk-detail-subBanner"]');
      if (subBannerBox && subBannerUrl) {
        subBannerBox.innerHTML = ""; // 기존 내용 초기화

        const img = document.createElement("img");
        img.src = subBannerUrl;
        img.alt = "서브 배너";
        img.className = "size-full object-cover min-h-screen";

        subBannerBox.appendChild(img);
      }
    }

    function updateLinks(url) {
      const linkEls = document.querySelectorAll('[cnb_module="shk-detail-link"]');
      linkEls.forEach((el) => {
        if (el.tagName.toLowerCase() === "a") {
          el.setAttribute("href", url);
        } else {
          el.dataset.url = url;
        }
      });
    }

    function updateInformation(infoData) {
      const infoBox = document.querySelector('[cnb_module="shk-detail-information"]');
      if (!infoBox || !infoData) return;

      infoBox.innerHTML = "";

      if (infoData.title) {
        const titleEl = document.createElement("div");
        titleEl.className = "text-[24px] font-semibold mb-6 leading-[130%]";
        titleEl.innerHTML = infoData.title;
        infoBox.appendChild(titleEl);
      }

      if (infoData.text) {
        const textEl = document.createElement("div");
        textEl.className = "text-[#464646] text-sm md:text-lg pb-6 md:pb-8 border-b border-[#DDDDDD]";
        textEl.textContent = infoData.text;
        infoBox.appendChild(textEl);
      }

      const metaArray = extractMeta(infoData);
      if (Array.isArray(infoData.meta) && infoData.meta.length > 0) {
        const metaWrap = document.createElement("div");
        metaWrap.className = "mt-8 flex gap-6 flex-col md:flex-row justify-between md:items-center";

        infoData.meta.forEach((item) => {
          const box = document.createElement("div");
          box.className = "flex flex-col gap-3";

          const label = document.createElement("div");
          label.className = "text-[#888888] text-sm";
          label.textContent = item.label.charAt(0).toUpperCase() + item.label.slice(1);

          const value = document.createElement("div");
          value.className = "text-lg text-[#121212]";
          value.textContent = item.value;

          box.appendChild(label);
          box.appendChild(value);
          metaWrap.appendChild(box);
        });

        infoBox.appendChild(metaWrap);
      }
    }

    function extractMeta(infoData) {
      return Object.entries(infoData)
        .filter(([key]) => !["title", "text"].includes(key))
        .map(([key, value]) => ({ label: key, value }));
    }

    function updateSwiper(slides) {
      const swiperWrapper = document.querySelector("#pages .swiper-wrapper");
      const templateSlide = document.querySelector('#pages [cnb-module="shk-detail-slide"]');

      if (!swiperWrapper || !templateSlide || !Array.isArray(slides)) return;

      // 기존 슬라이드 초기화 (템플릿만 남겨두고 비움)
      swiperWrapper.innerHTML = "";

      slides.forEach((src) => {
        // 템플릿 복제
        const slide = templateSlide.cloneNode(true);
        slide.removeAttribute("cnb-module"); // 복제본에서는 속성 제거 (선택 혼동 방지)

        // 이미지 생성
        const img = document.createElement("img");
        img.src = src;
        img.alt = "프로젝트 슬라이드";
        img.className = "size-full object-cover";

        slide.appendChild(img);
        swiperWrapper.appendChild(slide);
      });

      // ✅ Swiper 초기화
      new Swiper("#pages .swiper", {
        direction: "horizontal",
        loop: true,
        slidesPerView: 1.2,
        spaceBetween: 12,
        centeredSlides: true,
        pagination: {
          el: "#pages .swiper-pagination",
          clickable: true,
        },
        breakpoints: {
          768: {
            slidesPerView: 1.5,
            spaceBetween: 48,
          },
        },
      });
    }

    function updateGrid(images) {
      const gridBox = document.querySelector('[cnb_module="shk-detail-grid"]');
      if (!gridBox || !Array.isArray(images)) return;

      gridBox.innerHTML = ""; 

      images.forEach((src, index) => {
        const wrapper = document.createElement("div");

        if (images.length % 2 !== 0 && index === images.length - 1) {
          wrapper.className = "w-full md:h-[960px] aspect-[948/880] md:col-span-2";
        } else {
          wrapper.className = "aspect-[948/880]";
        }

        const img = document.createElement("img");
        img.src = src;
        img.alt = "프로젝트 이미지";
        img.className = "size-full object-cover";

        wrapper.appendChild(img);
        gridBox.appendChild(wrapper);
      });
    }

    function updateButtonState(currentId, totalProjects, prevBtn, nextBtn) {
      if (!prevBtn || !nextBtn) return;

      if (currentId <= 1) {
        prevBtn.disabled = true;
        prevBtn.classList.add("opacity-40", "cursor-not-allowed");
      } else {
        prevBtn.disabled = false;
        prevBtn.classList.remove("opacity-40", "cursor-not-allowed");
      }

      if (currentId >= totalProjects) {
        nextBtn.disabled = true;
        nextBtn.classList.add("opacity-40", "cursor-not-allowed");
      } else {
        nextBtn.disabled = false;
        nextBtn.classList.remove("opacity-40", "cursor-not-allowed");
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      portfolioInit(onPortfolioReady);
      function portfolioInit(callback) {
        if (typeof portfolioData === "undefined") {
          setTimeout(() => portfolioInit(callback), 100);
          return;
        }

        const params = new URLSearchParams(window.location.search);
        const id = Number(params.get("id"));
        const project = portfolioData.find((item) => item.id === id);

        console.log(project);

        if (project && typeof callback === "function") {
          callback(project);
        }
      }
    });
  </script>
</html>
